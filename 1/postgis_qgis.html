<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Визуализация данных PostGIS в настольном ГИС приложении</title>

<topbar style="display:none;">
    <item><a href="../index.html">Домой</a></item>
    <item><a href="../intro.html">О курсе</a></item>
</topbar>

</head>
<body>
<xmp theme="simplex" style="display:none;">

Чтобы просмотреть, что из себя представляют загруженные в БД слои, откроем
их в настольном клиенте QGIS. Процесс установки QGIS в Windows описан в
статье [Установка QGIS/GRASS с помощью OSGeo4W](http://gis-lab.info/qa/qgis-osgeo4w.html).
Описание способов установки для различных ОС приведено [здесь](http://qgis.org/ru/site/forusers/download.html).

1. Запустите QGIS и в меню *Слой* выберите пункт *Добавить слой PostGIS*;
2. Нажмите кнопку *Создать* и в открывшемся окне введите параметры
   PostGIS-соединения:

   * **Имя** - произвольная строка по которой вы сможете идентифицировать
     данное PostGIS-соединение в списке доступных соединений;
   * **Узел** - адрес хоста на котором запущен PostgreSQL;
   * **Порт** - порт, который прослушивает PostgfeSQL (по умолчанию 5432);
   * **База данных** - `dbvega`;
   * **Пользователь** - `pguser`;
   * **Пароль** - `topsecret`;

   Отметьте пункты *Сохранить пользователя* и *Сохранить пароль* и нажмите OK:

   ![][01-qgis-01]

3. В открывшемся окне нажмите кнопку *Подключиться*, после чего вы увидите
   список слоёв PostGIS, доступных на сервере.

   ![][01-qgis-02]

4. Отметьте слои, которые вы желаете отобразить и нажмите кнопку *Добавить*.
   Примерно так (с настроенной символикой) будут выглядеть слои `water_polygon`
   и `building_polygon`:

   ![][01-qgis-03]

Отображение PostGIS-слоёв, построенных на базе произвольных запросов
--------------------------------------------------------------------

Для выполнения данной задачи нам потребуется плагин для QGIS под названием
**RT Sql Layer**. Если в системе не установлена библиотека psycopg2, то
установите её. В Ubuntu (и Debian) это делается следующим образом:

    sudo aptitude install python-psycopg2

Если у вас был запущен QGIS, то перезапустите его. Для установки плагина перейдите
в меню *Модули &#10139; Загрузить модули*, в этом окне на вкладке *Репозитории*
подключите сторонние репозитории (старые версии QGIS), после чего во вкладке
*Модули* найдите модуль **RT Sql Layer** и установите его. После того, как
модуль будет установлен - запустите его с помощью кнопку, появившейся на панели
инструментов:

![][01-qgis-04]

В окне модуля в меню `Database` выберите базу данных `vega`, после чего нажмите
на кнопку *Query builder*. Рассматриваемый плагин требует того, чтобы результат
SQL-запроса содержал как минимум 2 поля - поле первичного ключа и поле геометрии.

Выполним следующий запрос:

    SELECT ogc_fid, ST_Buffer(ST_Transform(wkb_geometry, 3857), 5), name FROM building_polygon LIMIT 100;

В результате чего будет запрошено 100 геометрий, перепроецированных
в новую проекцию и с построенным пятиметровым буфером. Операции по
перепроецированию и построению буфера выполняются на стороне сервера.

![][01-qgis-05]

Если поверх этого слоя отобразить оригинальные геометрии (включив
в QGIS преобразование координат *на лету* в проекцию 3857), то это
будет выглядеть следующим образом:

![][01-qgis-06]

Начиная с версии QGIS 1.8 появилось расширение ядра **DB Manager**, объединяющее
и расширяющее возможности различных сторонних плагинов, в том числе и
**RT Sql Layer**.

[01-qgis-01]: ../img/01-qgis-01.png
[01-qgis-02]: ../img/01-qgis-02.png
[01-qgis-03]: ../img/01-qgis-03.png
[01-qgis-04]: ../img/01-qgis-04.png
[01-qgis-05]: ../img/01-qgis-05.png
[01-qgis-06]: ../img/01-qgis-06.png

</xmp>
<script src="../strapdown/v/0.2/strapdown.js"></script>
<script src="../strapdown-topbar/assets/strapdown/strapdown-topbar.min.js"></script>
<script src="../strapdown-topbar/assets/logo.js"></script>
<script src="../license.js"></script>
</body>
</html>
