<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<title>Сервисы доставки данных OWS</title>

<xmp theme="united" style="display:none;">

Введение
--------

Под акронимом OWS (OGC Web Services) скрываются различные сервисы - WMS, WFS,
WCS и т.д. Попробуем разобраться для чего они существуют и какую цель
преследовали разработчики этих стандартов.

Самое простое из распространенных объяснений выглядит так:

* WMS - картинка (растр);
* WFS - вектор;
* WCS - грид (тоже растр, но другой).

![][02-web-services]

**Примем его за основу и задумаемся над таким вопросом. Если уже имеются
векторные или растровые данные, то зачем их превращать в сервис?**

Данные хранятся в файлах и базах данных, которые для простоты будем называть
*хранилищами*. Сервисы занимаются транспортировкой данных из хранилищ к
клиентам (чтение) и обратно (запись). Они также обслуживают различные
запросы пользователей. Для географических сервисов это могут быть указания о

* перепроецировании данных;
* применении атрибутивных (country='RUSSIA') фильтров;
* применении пространственных (объекты в радиусе 100 м) фильтров;
* преобразовании форматов.

Если данные хранятся в файлах, то их можно просто загрузить целиком, нельзя
взять только нужную часть. При этом программа-клиент должна будет
самостоятельно разобраться в их внутреннем формате. Примеры распространенных
векторных и растровых форматов, применяемых в ГИС: ESRI Shapefile, MapInfo,
SXF, GeoJSON, KML, GeoTIFF, ECW и др.

При разработке программы-клиента требуется, как минимум, реализация базовых
операций ввода-вывода. Часть из этих задач решается использованием готовых
библиотек, например, GDAL/OGR. Для хранения векторов и растров консорциумом
OGC предложен формат GML (Geography Markup Language), но он удобен только в
роли обменного формата, слабо применим в хранении (из-за избыточного объема)
и обладает низкой скоростью чтения и записи.

Доступ к базам данных осуществляется с помощью запросов SQL. Но этот язык
имеет несколько диалектов, полнота реализации стандарта разнится, да и сама
процедура подключения к БД несколько отличается для разных продуктов.
Форматы географического описания объектов (геометрия) в большинстве БД
следуют рекомендациям OGC Simple Features и специфические форматы на
сегодняшний день можно считать ушедшими в прошлое.

При разработке тонкого клиента или узко специализированного инструмента
обработки данных желателен один универсальный интерфейс ко всем форматам и
методам доступа. Использование сервисов OWS потребует организовать поддержку
только одного формата (например, GML). Причем исходные данные могут
храниться в самых различных видах и вся работа с ними перекладывается на
плечи сервера. А значит, инструмент ГИС может получить то что ему требуется,
не прилагая усилий. Например, многие существующие серверы позволяют
предоставлять в сервисе WFS данные не только в формате GML, но во многих
других векторных форматах - GeoJSON, ESRI Shapefile, DWG и т.п. Такой сервис
можно встроить в уже существующую цепочку обработки данных,
незначительно доработав программы, и получить доступ к широкому спектру хранилищ.

Стоит отметить, что спецификации OGC не описывают устройство программы-сервера.
От нее требуется только предоставлять на выходе *правильный* сервис.
А что происходит внутри, как реализованы процедуры ввода/вывода,
перепроецирования, фильтрации и откуда сервер получает данные, может быть
полностью скрыто от пользователя. Например, можно создать сервер WFS,
который будет обращаться в интернет и собирать веб-страницы с прогнозами
погоды, сопоставлять названия населенных пунктов с их координатами из БД,
преобразовывать в пространственные объекты (точки с семантикой) и
предоставлять (опубликовывать) в виде сервиса. Программа-клиент не знает
источник данных, но может свободно с ними работать. Аналогично с
применением фильтров. Очевидно, что для БД PostGIS и файла ESRI Shapefile
на уровне технической реализации потребуются абсолютно разные подходы.
Но это, опять же, забота сервера, а на уровне сервиса все фильтры описываются
одинаково (спецификация Filter Encoding).

Вывод - сервисы OWS не порождают новые данные, а занимаются только их
доставкой (транспортировкой). Чуть позже, мы отойдем от такой трактовки, но
в первом приближении к ним следует относиться именно так.

WFS (Web Feature Service)
-------------------------

Сервис WFS скрывает истинные хранилища данных и программа-клиент получает
поток векторных данных, при этом не зная взяты ли они из БД или из файла.
В спецификации WFS определено, что формат получаемых данных должен быть GML.
Тем не менее, формат строго не фиксирован и сервер WFS может предоставлять
дополнительные по своему усмотрению. Например, GeoJSON широко используется
в веб-приложениях за счет компактности и легкости обработки в
большинстве языков программирования.

Использование готового сервера будет обладать следующими преимуществами:

* унифицированные операции работы с данными, не зависящие от конкретной
  реализации;
* свободная миграция между хранилищами данных;
* единый язык описания фильтров (пусть и с потерей отдельных возможностей
  конкретного хранилища);
* перепроецирование;
* различные форматы на выходе (GML, GeoJSON, CSV).

**Вывод** - сервис WFS предназначен для доставки векторных данных с
минимальной их обработкой (преобразование форматов) в прямом и обратном
направлении (чтение-запись) с возможностью задания фильтров. Подробнее узнать
о том, что такое WFS можно в статье [Знакомство с Web Feature Service](http://gis-lab.info/qa/wfs-begin.html)

WCS (Web Coverage Service)
--------------------------

Сервис работает с данными, которые описываются терминами `грид` (grid) или
`покрытие` (сoverage). Реальные примеры - космоснимки, данные с
многоканальных сенсоров ДЗЗ, модели рельефа (DEM) и т.п. Все они имеют
схожий формат хранения - прямоугольная область, разделенная по регулярной
сетке, в каждой ячейке которой содержится несколько значений.
Для многоканальных сенсоров в каждой ячейке число значений будет
равно количеству каналов. Частными случаями многоканального грида являются
RGB-композит (3 канала - red, green, blue) и модель рельефа
(1 канал - высота). Строго говоря, WCS умеет работать и с нерегулярными
криволинейными сетками, с TIN и произвольными сетями.

При работе с гридами требуются операции:

* доступ к отдельным каналам;
* выбор некоторой области растра;
* выбор по дате из серии снимков (временны́е запросы).

Как и для сервиса WFS задачи WCS сводятся к унифицированному доступу к
различным хранилищам (WKTRaster, RasterLite, rasdaman), базовым операциям
чтения-записи и применению фильтров. Форматы - расширенный GML,
GeoTIFF, JPEG2000 и др.

**Вывод** - сервис WCS предназначен для доставки растровых данных (грид).

WMS (Web Map Service)
---------------------

Все сервисы OWS спроектированы по общему принципу и WMS очень похож на
WFS и WCS. Но, если те были предназначены для доступа к существующим данным,
то в WMS происходит создание новых. На основе данных из WFS и WCS
(на практике чаще используют прямой доступ к хранилищам) сервис WMS создает
карты с заданными стилями оформления. Можно взглянуть на его работу и с
такой позиции - он занимается транспортировкой данных, представляя их в
несколько иной форме. Зачастую, WMS используют для доступа к мозаиками
космоснимков, хотя с формальной точки зрения это задача WCS.

![][02-web-services-01]

Наиболее распространенный пример работы WMS - создание топо-карт из
растровых (космоснимки, сканированные планшеты) и векторных данных
(дороги, гидрография, населенные пункты).

Характеристики WMS:

* базовые понятия - *слой* и *стиль*;
* цель - получение карты, это не обязательно должен быть RGB-растр,
  широко используются форматы PDF, SVG, SWF;
* задача сервиса - принять от клиента указания и вернуть их графическое
  представление;
* главный элемент - это рендер.

Отдельно хотелось бы заострить внимание на рендере. Этот элемент занимается
преобразованием исходных данных в формат изображения. Например, векторные
линии с учетом заданных стилей преобразует в представление автодорог, а
полигоны окрашивает в цвет лесов.

**Вывод** - сервис WMS создает карты, получает указания от клиентов и
доставляет готовый результат. Изменение (запись) в хранилища данных в этом
сервисе не предусмотрена.


WPS (Web Processing Service)
----------------------------

Второй сервис, который создает данные. Но если WMS мог только незначительно
влиять на объекты (функции трансформации в фильтрах стилей SLD), то WPS -
это интерфейс к возможностям настольных ГИС, пакетам гео-моделирования,
инструментам статистики и обработки. Результатом его работы могут быть как
растровые, так и векторные данные.

Мир ГИС представлен богатым разнообразием инструментов: консольные пакеты
типа GRASS; библиотеки для разработчиков на различных языках программирования
(GeoTools, GEOS, Sextante); настольные приложения (FME, ArcGIS); модели и
симуляторы окружающей среды (Drift-X).

Все они различаются по способам ввода, допустимым форматам данных, методам
доступа к функциям обработки и, чисто технически, они по разному устроены.
Задача WPS сводится к созданию общего универсального интерфейса для работы со
всеми возможными инструментами. Спецификация определяет формат данных, доступ
к спискам реализованных функций, процедуры запуска и остановки обработки,
способы получения результата.

Сервер WPS скрывает все взаимодействие с библиотеками и программами обработки.
И для клиента все операции выглядят единообразно независимо от того, кто
реально обрабатывает данные.

Например, стоит задача "выполнить теневую отмывку рельефа". Допустим, что
грид рельефа доступен по WCS. Тогда задачу можно решить двумя способами.
Первый - открыть настольную программу типа SAGA GIS, загрузить грид и
применить метод из богатой библиотеки этой программы. В результате получим
растровое изображение. Второй - работая в Quantum GIS обратиться на сервер WPS,
выбрать функцию, выполняющую теневую отмывку, передать ей ссылку на WCS и
получить отмывку.

Второй способ интересен разделением труда: одни программисты создают программы
для пользователей, в которых удобно работать, визуально анализировать
результаты обработки, создавать компоновки для печати; другие программисты
заняты реализацией алгоритмов обработки данных, выбирая удобные им языки и
технологии. При этом сервер WPS может физически работать на том же компьютере
где и программа-клиент, а может быть вынесен на мощный сервер.
Программа gvSIG GIS помимо собственных методов обработки позволяет обратиться
к возможностям библиотеки SEXTANTE. В Quantum GIS построена интеграция с GRASS
и Orfeo Toolbox. Сервер WPS позволил бы работать со всеми тремя библиотеками
как в gvSIG так и в Quantum GIS.

**Вывод** - обрабатывает существующие и создает новые данные.

Заключение
----------

Сервисы OWS являются интерфейсами между клиентами и хранилищами данных
(WFS, WCS). Создают среду взаимодействия клиентов с инструментами обработки
(WMS, WPS) и сервисов между собой. Позволяют строить цепочки преобразования
данных в результат. Например, возьмем из БД грид рельефа, по WCS отправим в
WPS для построения изолиний, затем полилинии нанесем на топокарту с нужной
толщиной линии, бергштрихами и подписями, результат передадим клиенту (WMS).

[02-web-services]: ../img/02-web-services.png
[02-web-services-01]: ../img/02-web-services-01.png

</xmp>

<script src="../strapdown/v/0.1/strapdown.js"></script>
</html>